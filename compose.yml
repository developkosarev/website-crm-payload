services:
  #payload:
  #  image: node:18-alpine
  #  ports:
  #    - '3000:3000'
  #  volumes:
  #    - .:/home/node/app
  #    - node_modules:/home/node/app/node_modules
  #  working_dir: /home/node/app/
  #  command: sh -c "yarn install && yarn dev"
  #  depends_on:
  #    - mongo
  #  env_file:
  #    - .env

  #mongo:
  #  image: mongo:latest
  #  ports:
  #    - '27017:27017'
  #  command:
  #    - --storageEngine=wiredTiger
  #  volumes:
  #    - data:/data/db
  #  logging:
  #    driver: none

  ###> doctrine/doctrine-bundle ###
  database:
    image: postgres:${POSTGRES_VERSION:-16}-alpine
    environment:
      - POSTGRES_DB=${POSTGRES_DB:-app}
      # You should definitely change the password in production
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-!ChangeMe!}
      - POSTGRES_USER=${POSTGRES_USER:-app}
    healthcheck:
      test: [ "CMD", "pg_isready", "-d", "${POSTGRES_DB:-app}", "-U", "${POSTGRES_USER:-app}" ]
      timeout: 5s
      retries: 5
      start_period: 60s
    ports:
      - target: 5432
        published: 5432
        protocol: tcp
    volumes:
      - database_payload:/var/lib/postgresql/data:rw
      # You may use a bind-mounted host directory instead, so that it is harder to accidentally remove the volume and lose all your data!
      # - ./api/docker/db/data:/var/lib/postgresql/data:rw

volumes:
  database_payload:
